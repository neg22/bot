import telebot
import requests
from bs4 import BeautifulSoup
import time
import random

bot = telebot.TeleBot('5496027166:AAEN80Mpt2y69jan241P5KLLoZmSeoPzsOY') #–∫–ª—é—á –∏–Ω–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä

@bot.message_handler(content_types=["text"]) # –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 
def repeat_all_messages(message): # –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –∏–≥—Ä–∞–µ—Ç –Ω–∏–∫–∞–∫–æ–π —Ä–æ–ª–∏, –ø—Ä–∏–Ω–∏–∞–µ—Ç —Ç–µ–∫—Å—Ç (–º–æ–∂–µ—Ç –∏ –¥–æ–∫–∏ –∏ –∞—É–¥–∏–æ) 
    if message.text == "/start":
        bot.send_message(message.from_user.id, "–ü—Ä–∏–≤–µ—Ç, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –µ—Å—Ç—å –Ω–∞–ø–∏—à–∏ /help")
    elif message.text == "/help":
        bot.send_message(message.from_user.id, "–ü–æ–∫–∞ –Ω–∏—Ö—É—è—à–∏–Ω—å–∫–∏ –Ω–µ—Ç ü´£")
    elif message.text == "/–ø–æ–≥–æ–¥–∞":
        print('–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç –æ–±—Ä–∞—â–∞–µ—Ç—å—Å—è –∫ —Å–∞–π—Ç—É Yandex–ü–æ–≥–æ–¥–∞ –∏ —Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç ')
        print('')
        print('------')
        print('—Ç–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ–∂–¥—å –∏–ª–∏ –∏–¥–µ—Ç !–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ –∫–∞–∫ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —è–Ω–¥–µ–∫—Å! –∏ –¥–∞–ª–µ–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —á–∞—Ç')
        print('------')
        print('')
        print('n:n:n –í —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç –¥–æ–∂–¥—å –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è - !—ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!  ')
        print('')
        print('e—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç None —ç—Ç–æ –∑–Ω–∞—á–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–∏—à–ª–∏ –ø–æ –∫–∞–∫–æ–π—Ç–æ –ø—Ä–∏—á–∏–Ω–µ, –ª–∏–±–æ –æ—Ç–≤–∞–ª–∏–ª—Å—è –Ω—ç—Ç –ª–∏–±–æ —è–Ω–¥–µ–∫—Å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª –¥–∏–≤ –Ω–∞ –≤—Ä–µ–º—è - –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤ ')
        print('')

        while 1 == 1:
            url = "https://yandex.ru/pogoda/maps/nowcast?lat=57.62656&lon=39.893813&via=mmapw&le_Lightning=1&ll=39.893813_57.626560&z=9"
            yslovie = '—è—Å–Ω–æ. –í –±–ª–∏–∂–∞–π—à–∏–µ 2 —á–∞—Å–∞ –æ—Å–∞–¥–∫–æ–≤ –Ω–µ¬†–æ–∂–∏–¥–∞–µ—Ç—Å—è'

            r = requests.get(url)
            soup = BeautifulSoup(r.text, 'lxml')
            s = soup.find('div', class_='weather-maps-fact__nowcast-alert') #—Ç–∞–∫ —Å–≤–∞–ª–∏–≤–∞–µ–º—Å—è –¥–æ –Ω—É–∂–Ω–æ–≥–æ –º–µ—Å—Ç–∞
            if s == None: # –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–≤–Ω–Ω—ã—Ö
                bot.send_message(message.from_user.id, s)
                print(s)
                time.sleep(60)
                continue
            s = s.text #—Ç–∞–∫ –≤—ã—Ç–∞—Å–∫–∏–≤–∞—Ç—å # –±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω—É–ª
            str(s)

            theFirstCondition = "–æ–∂–∏–¥–∞–µ—Ç—Å—è"
            theSecondCondition = "–¥–æ–∂–¥—å"
            arr = s.split() # –∏–∑ —Å—Ç—Ä–æ–∫–∏ –¥–µ–ª–∞–µ—Ç —Å–ø–∏—Å–æ–∫
            x = len(arr)    # –¥–ª–∏–Ω–Ω–∞ —Å–ø–∏—Å–∫–∞
            count = 0
            ok  =   0       # —Ñ–ª–∞–≥, –µ—Å–ª–∏ —Ñ–ª–∞–≥–∏ —Å–æ–π–¥—É—Ç—Å—è –∑–Ω–∞—á–∏—Ç –ø–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            tfc =   0       # —Ñ–ª–∞–≥ 
            tsc =   0       # —Ñ–ª–∞–≥

            while count < x:# –ø—Ä–æ–±–µ–∂–∞—Ç—å—Å—è –ø–æ —Å–ø–∏—Å–∫—É
                if arr[count] == theFirstCondition:     #–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–ª–æ–≤–∞
                    tfc = 1
                if arr[count] == theSecondCondition:    #–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–ª–æ–≤–∞
                    tsc = 1
                count = count + 1
                if tfc == 1 & tsc == 1: #–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                    ok = 1
            tfc = tsc = count = 0  #–æ–±–Ω—É–ª–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ —Å—á–µ—Ç—á–∏–∫–∞
            
            if ok == 1: #—É—Å–ª–æ–≤–∏–µ –Ω–∞ –ø–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                print('-----------------------------')
                #bot.send_message(message.from_user.id, "–ï—Å—Ç—å –ø–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ")
                print("–ï—Å—Ç—å –ø–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ")
                t = time.localtime()
                current_time = time.strftime("%H:%M:%S ", t)
                bot.send_message(message.from_user.id, current_time + s + " –ü–æ–¥—Ä–æ–±–Ω–µ–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ç https://yandex.ru/pogoda/maps/nowcast?lat=57.62656&lon=39.893813&via=mmapw&le_Lightning=1&ll=39.893813_57.626560&z=9")
                print(current_time + s)
                print('-----------------------------')
            else:
                t = time.localtime()
                current_time = time.strftime("%H:%M:%S ", t)
                print(current_time + s)
            ok = 0
                
            time.sleep(600)
            print('-')




if __name__ == '__main__':
    bot.infinity_polling()
